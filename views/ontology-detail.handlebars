<!-- views/ontology-detail.handlebars - Updated with subject fetching -->
<ul class="breadcrumbs">
  <li><a href="/?showLabels={{showLabels}}">Hem</a></li>
  <li>{{ontology.title}}</li>
</ul>

<h1>{{ontology.title}}</h1>

<div class="display-mode">
  <label for="displayToggle">Visa mänskligt läsbara etiketter:</label>
  <label class="switch">
    <input type="checkbox" id="displayToggle" {{#if showLabels}}checked{{/if}}>
    <span class="slider"></span>
  </label>
  <span class="display-mode-text">{{#if showLabels}}På{{else}}Av{{/if}}</span>
</div>

<div class="resource-container">
  <div class="resource-main">
    <div class="resource-description">
      {{ontology.description}}
    </div>
    
    <div class="property-group">
      <div class="property-group-header">Metadata</div>
      <div class="property-group-content">
        <table class="property-table">
          {{#if ontology.creator}}
            <tr>
              <td class="property-name">Skapare</td>
              <td>{{ontology.creator}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.publisher}}
            <tr>
              <td class="property-name">Utgivare</td>
              <td>{{ontology.publisher}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.created}}
            <tr>
              <td class="property-name">Skapad</td>
              <td>{{ontology.created}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.modified}}
            <tr>
              <td class="property-name">Senast ändrad</td>
              <td>{{ontology.modified}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.version}}
            <tr>
              <td class="property-name">Version</td>
              <td>{{ontology.version}}</td>
            </tr>
          {{/if}}
        </table>
      </div>
    </div>
    
    <!-- New Section: All Subjects in GraphDB -->
    <div class="property-group">
      <div class="property-group-header">Alla Subjekt i GraphDB</div>
      <div class="property-group-content">
        <p>Visar alla distinkta subjekt från databasen:</p>
        
        <div class="action-links">
          <a href="/query?query={{encodeURIComponent 'SELECT DISTINCT ?s WHERE { ?s ?p ?o } LIMIT 100'}}&showLabels={{showLabels}}" class="btn" style="margin-bottom: 15px;">
            Kör subjekt-query
          </a>
        </div>
        
        <!-- Pre-populated query link -->
        <div class="subjects-query-box">
          <h4>SPARQL Query</h4>
          <pre>SELECT DISTINCT ?s WHERE { ?s ?p ?o } LIMIT 100</pre>
        </div>
        
        <!-- Optional: Additional filter options -->
        <div class="filter-panel">
          <h4>Filtrera subjekt</h4>
          <form action="/query" method="get" class="filter-form">
            <div class="form-group">
              <label for="subjectFilter">Filtrera efter mönster:</label>
              <input type="text" id="subjectFilter" name="subjectFilter" class="form-control" placeholder="Exempelvis: ontologi2025">
            </div>
            <input type="hidden" name="query" id="filteredQuery" value="SELECT DISTINCT ?s WHERE { ?s ?p ?o } LIMIT 100">
            <input type="hidden" name="showLabels" value="{{showLabels}}">
            <button type="submit" class="btn" onclick="updateQueryWithFilter(); return true;">Filtrera subjekt</button>
          </form>
        </div>
      </div>
    </div>
    
    <!-- Other existing sections remain unchanged -->
    <div class="property-group">
      <div class="property-group-header">Statistik</div>
      <div class="property-group-content">
        <table class="property-table">
          <tr>
            <td class="property-name">Klasser</td>
            <td>
              {{ontology.stats.classes}}
              {{#if ontology.stats.classes}}
                <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?class ?label WHERE { { ?class a <http://www.w3.org/2002/07/owl#Class> . FILTER(STRSTARTS(STR(?class), STR(<' ontology.uri '>))) } UNION { ?class a <http://www.w3.org/2000/01/rdf-schema#Class> . FILTER(STRSTARTS(STR(?class), STR(<' ontology.uri '>))) } OPTIONAL { ?class <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?class LIMIT 100')}}&showLabels={{showLabels}}" class="btn btn-small">Visa</a>
              {{/if}}
            </td>
          </tr>
          <tr>
            <td class="property-name">Egenskaper</td>
            <td>
              {{ontology.stats.properties}}
              {{#if ontology.stats.properties}}
                <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?property ?label WHERE { { ?property a <http://www.w3.org/2002/07/owl#ObjectProperty> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } UNION { ?property a <http://www.w3.org/2002/07/owl#DatatypeProperty> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } UNION { ?property a <http://www.w3.org/1999/02/22-rdf-syntax-ns#Property> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } OPTIONAL { ?property <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?property LIMIT 100')}}&showLabels={{showLabels}}" class="btn btn-small">Visa</a>
              {{/if}}
            </td>
          </tr>
          <tr>
            <td class="property-name">Individer</td>
            <td>
              {{ontology.stats.individuals}}
              {{#if ontology.stats.individuals}}
                <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?individual ?label WHERE { { ?individual a <http://www.w3.org/2002/07/owl#NamedIndividual> . FILTER(STRSTARTS(STR(?individual), STR(<' ontology.uri '>))) } UNION { ?individual a ?class . ?class <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <' ontology.uri '> . FILTER NOT EXISTS { ?individual a <http://www.w3.org/2002/07/owl#Class> } } OPTIONAL { ?individual <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?individual LIMIT 100')}}&showLabels={{showLabels}}" class="btn btn-small">Visa</a>
              {{/if}}
            </td>
          </tr>
        </table>
      </div>
    </div>
    
    <!-- Continue with relationships section and other existing sections... -->
    {{#if ontology.relationships.length}}
    <div class="property-group">
      <div class="property-group-header">Objektrelationer</div>
      <div class="property-group-content">
        <p>Dessa relationer definieras i ontologin för att beskriva samband mellan olika klasser och koncept:</p>
        
        <table class="relationships-table">
          <thead>
            <tr>
              <th>Relation</th>
              <th>Domän</th>
              <th>Range</th>
              <th>Detaljer</th>
            </tr>
          </thead>
          <tbody>
            {{#each ontology.relationships}}
              <tr>
                <td>
                  <a href="/resource?uri={{encodeURIComponent this.property.uri}}&showLabels={{../showLabels}}">
                    {{this.property.label}}
                  </a>
                </td>
                <td>
                  {{#if this.domain.uri}}
                    <a href="/resource?uri={{encodeURIComponent this.domain.uri}}&showLabels={{../showLabels}}">
                      {{this.domain.label}}
                    </a>
                  {{else}}
                    <em>Ospecificerad</em>
                  {{/if}}
                </td>
                <td>
                  {{#if this.range.uri}}
                    <a href="/resource?uri={{encodeURIComponent this.range.uri}}&showLabels={{../showLabels}}">
                      {{this.range.label}}
                    </a>
                  {{else}}
                    <em>Ospecificerad</em>
                  {{/if}}
                </td>
                <td>
                  <button class="btn btn-small" data-relationship-id="{{@index}}" onclick="showRelationshipDetails('{{@index}}')">Visa detaljer</button>
                </td>
              </tr>
              <tr id="relationship-details-{{@index}}" style="display: none;">
                <td colspan="4" class="relationship-details">
                  <!-- Existing relationship details... -->
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>
    {{/if}}
    
    <!-- Products section and other existing sections remain unchanged -->
  </div>
  
  <div class="resource-sidebar ontology-sidebar">
    <!-- Existing sidebar content... -->
  </div>
</div>

<style>
  /* Existing styles... */
  
  /* New styles for subjects query section */
  .subjects-query-box {
    background-color: #f5f5f5;
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
  }
  
  .subjects-query-box pre {
    margin: 0;
    font-family: monospace;
    overflow-x: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  
  .filter-panel {
    background-color: #f9f9f9;
    padding: 15px;
    border-radius: 4px;
    border: 1px solid #eaecf0;
    margin-bottom: 20px;
  }
  
  .filter-form .form-group {
    margin-bottom: 15px;
  }
  
  .filter-form .form-control {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
</style>

<script>
  // Existing script functions...
  
  // Function to update query with filter
  function updateQueryWithFilter() {
    const filterInput = document.getElementById('subjectFilter');
    const queryInput = document.getElementById('filteredQuery');
    
    if (filterInput && filterInput.value && queryInput) {
      const filterValue = filterInput.value.trim();
      let updatedQuery = `SELECT DISTINCT ?s WHERE { ?s ?p ?o . FILTER(CONTAINS(STR(?s), "${filterValue}")) } LIMIT 100`;
      queryInput.value = updatedQuery;
    }
  }
</script>