<!-- views/ontology-detail.handlebars - Simplified Subject Query -->
<ul class="breadcrumbs">
  <li><a href="/?showLabels={{showLabels}}">Hem</a></li>
  <li>{{ontology.title}}</li>
</ul>

<h1>{{ontology.title}}</h1>

<div class="display-mode">
  <label for="displayToggle">Visa mänskligt läsbara etiketter:</label>
  <label class="switch">
    <input type="checkbox" id="displayToggle" {{#if showLabels}}checked{{/if}}>
    <span class="slider"></span>
  </label>
  <span class="display-mode-text">{{#if showLabels}}På{{else}}Av{{/if}}</span>
</div>

<div class="resource-container">
  <div class="resource-main">
    <div class="resource-description">
      {{ontology.description}}
    </div>
    
    <div class="property-group">
      <div class="property-group-header">Metadata</div>
      <div class="property-group-content">
        <table class="property-table">
          {{#if ontology.creator}}
            <tr>
              <td class="property-name">Skapare</td>
              <td>{{ontology.creator}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.publisher}}
            <tr>
              <td class="property-name">Utgivare</td>
              <td>{{ontology.publisher}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.created}}
            <tr>
              <td class="property-name">Skapad</td>
              <td>{{ontology.created}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.modified}}
            <tr>
              <td class="property-name">Senast ändrad</td>
              <td>{{ontology.modified}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.version}}
            <tr>
              <td class="property-name">Version</td>
              <td>{{ontology.version}}</td>
            </tr>
          {{/if}}
        </table>
      </div>
    </div>
    
    <!-- Subjects section: Direct query link -->
    <div class="property-group">
      <div class="property-group-header">Ontologins Subjekt</div>
      <div class="property-group-content">
        <p>Visar alla relaterade subjekt för denna ontologi:</p>
        
        <div class="action-links" style="margin-top: 15px;">
          <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?s WHERE { { ?s <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <' ontology.uri '> . } UNION { ?s ?p ?o . FILTER(STRSTARTS(STR(?s), STR(<' ontology.uri '>))) } } ORDER BY ?s LIMIT 100')}}&showLabels={{showLabels}}" class="btn">
            Visa alla subjekt i denna ontologi
          </a>
        </div>
        
        <div class="info-box" style="margin-top: 20px;">
          <h3>Typiska subjekt i denna ontologi</h3>
          <ul style="margin-top: 10px;">
            <li>Klasser som definierar koncept</li>
            <li>Egenskaper som beskriver relationerna</li>
            <li>Individer som representerar specifika instanser</li>
          </ul>
          <p style="margin-top: 10px;">
            Klicka på knappen ovan för att se alla subjekt i en sökbar tabell.
          </p>
        </div>
      </div>
    </div>
    
    <div class="property-group">
      <div class="property-group-header">Statistik</div>
      <div class="property-group-content">
        <table class="property-table">
          <tr>
            <td class="property-name">Klasser</td>
            <td>
              {{ontology.stats.classes}}
              {{#if ontology.stats.classes}}
                <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?class ?label WHERE { { ?class a <http://www.w3.org/2002/07/owl#Class> . FILTER(STRSTARTS(STR(?class), STR(<' ontology.uri '>))) } UNION { ?class a <http://www.w3.org/2000/01/rdf-schema#Class> . FILTER(STRSTARTS(STR(?class), STR(<' ontology.uri '>))) } OPTIONAL { ?class <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?class LIMIT 100')}}&showLabels={{showLabels}}" class="btn btn-small">Visa</a>
              {{/if}}
            </td>
          </tr>
          <tr>
            <td class="property-name">Egenskaper</td>
            <td>
              {{ontology.stats.properties}}
              {{#if ontology.stats.properties}}
                <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?property ?label WHERE { { ?property a <http://www.w3.org/2002/07/owl#ObjectProperty> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } UNION { ?property a <http://www.w3.org/2002/07/owl#DatatypeProperty> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } UNION { ?property a <http://www.w3.org/1999/02/22-rdf-syntax-ns#Property> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } OPTIONAL { ?property <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?property LIMIT 100')}}&showLabels={{showLabels}}" class="btn btn-small">Visa</a>
              {{/if}}
            </td>
          </tr>
          <tr>
            <td class="property-name">Individer</td>
            <td>
              {{ontology.stats.individuals}}
              {{#if ontology.stats.individuals}}
                <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?individual ?label WHERE { { ?individual a <http://www.w3.org/2002/07/owl#NamedIndividual> . FILTER(STRSTARTS(STR(?individual), STR(<' ontology.uri '>))) } UNION { ?individual a ?class . ?class <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <' ontology.uri '> . FILTER NOT EXISTS { ?individual a <http://www.w3.org/2002/07/owl#Class> } } OPTIONAL { ?individual <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?individual LIMIT 100')}}&showLabels={{showLabels}}" class="btn btn-small">Visa</a>
              {{/if}}
            </td>
          </tr>
        </table>
      </div>
    </div>
    
    <!-- Continue with relationships section and other existing sections... -->
    {{#if ontology.relationships.length}}
    <div class="property-group">
      <div class="property-group-header">Objektrelationer</div>
      <div class="property-group-content">
        <p>Dessa relationer definieras i ontologin för att beskriva samband mellan olika klasser och koncept:</p>
        
        <table class="relationships-table">
          <thead>
            <tr>
              <th>Relation</th>
              <th>Domän</th>
              <th>Range</th>
              <th>Detaljer</th>
            </tr>
          </thead>
          <tbody>
            {{#each ontology.relationships}}
              <tr>
                <td>
                  <a href="/resource?uri={{encodeURIComponent this.property.uri}}&showLabels={{../showLabels}}">
                    {{this.property.label}}
                  </a>
                </td>
                <td>
                  {{#if this.domain.uri}}
                    <a href="/resource?uri={{encodeURIComponent this.domain.uri}}&showLabels={{../showLabels}}">
                      {{this.domain.label}}
                    </a>
                  {{else}}
                    <em>Ospecificerad</em>
                  {{/if}}
                </td>
                <td>
                  {{#if this.range.uri}}
                    <a href="/resource?uri={{encodeURIComponent this.range.uri}}&showLabels={{../showLabels}}">
                      {{this.range.label}}
                    </a>
                  {{else}}
                    <em>Ospecificerad</em>
                  {{/if}}
                </td>
                <td>
                  <button class="btn btn-small" data-relationship-id="{{@index}}" onclick="showRelationshipDetails('{{@index}}')">Visa detaljer</button>
                </td>
              </tr>
              <tr id="relationship-details-{{@index}}" style="display: none;">
                <td colspan="4" class="relationship-details">
                  <div class="relationship-diagram">
                    <span class="object-relation domain">{{this.domain.label}}</span>
                    <span class="relation-arrow">→</span>
                    <span class="object-relation property">{{this.property.label}}</span>
                    <span class="relation-arrow">→</span>
                    <span class="object-relation range">{{this.range.label}}</span>
                  </div>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>
    </div>
    {{/if}}
    
    <!-- Products section -->
    {{#if ontology.products.length}}
    <div class="property-group">
      <div class="property-group-header">Relaterade Produkter</div>
      <div class="property-group-content">
        <p>Följande produkter är relaterade till denna ontologi:</p>
        
        <div class="product-grid">
          {{#each ontology.products}}
            <div class="product-card {{#if this.isSubject}}subject-product{{else}}object-product{{/if}}">
              <div class="product-card-header">
                <h3>
                  <a href="/product/detail?uri={{encodeURIComponent this.uri}}&showLabels={{../showLabels}}">
                    {{this.name}}
                  </a>
                </h3>
              </div>
              <div class="product-card-body">
                {{#if this.description}}
                  <p class="description">{{truncate this.description 150}}</p>
                {{else}}
                  <p class="description"><em>Ingen beskrivning tillgänglig</em></p>
                {{/if}}
                
                <div class="product-meta">
                  {{#if this.isNotor}}
                    <span class="product-tag notor-tag">Notor65</span>
                  {{/if}}
                  
                  {{#if this.isSubject}}
                    <span class="product-tag subject-tag">Refererar till ontologi</span>
                  {{else}}
                    <span class="product-tag object-tag">Definierad av ontologi</span>
                  {{/if}}
                </div>
              </div>
            </div>
          {{/each}}
        </div>
        
        {{#if ontology.products.length}}
          <div class="view-more-container">
            <a href="/ontology/products?uri={{encodeURIComponent ontology.uri}}&showLabels={{showLabels}}" class="btn">Visa alla produkter</a>
          </div>
        {{/if}}
      </div>
    </div>
    {{/if}}
  </div>
  
  <div class="resource-sidebar ontology-sidebar">
    <div class="sidebar-box">
      <div class="sidebar-box-header">Ontologi Information</div>
      <div class="sidebar-box-content">
        <div class="resource-uri">
          <code>{{ontology.uri}}</code>
        </div>
      </div>
    </div>
    
    <div class="sidebar-box">
      <div class="sidebar-box-header">Ladda ner Ontologi</div>
      <div class="sidebar-box-content">
        <ul class="download-links">
          {{#each downloadLinks}}
            <li>
              <a href="{{this.url}}" class="btn" download="{{../ontology.title}}.{{this.extension}}">
                <span class="download-icon">📥</span> {{this.format}}
              </a>
            </li>
          {{/each}}
        </ul>
      </div>
    </div>
    
    <div class="sidebar-box">
      <div class="sidebar-box-header">Åtgärder</div>
      <div class="sidebar-box-content">
        <p>
          <a href="/?showLabels={{showLabels}}" class="btn" style="width: 100%; margin-bottom: 8px;">Tillbaka till startsidan</a>
        </p>
        <p>
          <a href="/query?query={{encodeURIComponent (concat 'SELECT ?s ?p ?o WHERE { ?s ?p ?o . FILTER(STRSTARTS(STR(?s), STR(<' ontology.uri '>))) } LIMIT 100')}}&showLabels={{showLabels}}" class="btn" style="width: 100%;">Visa alla triplar</a>
        </p>
      </div>
    </div>
  </div>
</div>

<style>
  /* Base styles for the resource container */
  .resource-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 20px;
  }
  
  .resource-main {
    flex: 3;
    min-width: 0;
  }
  
  .resource-sidebar {
    flex: 1;
    min-width: 250px;
  }
  
  /* Resource description */
  .resource-description {
    font-size: 1.1em;
    line-height: 1.6;
    margin-bottom: 25px;
    color: #333;
    background-color: #f9f9f9;
    padding: 20px;
    border-left: 4px solid #0645ad;
    border-radius: 0 4px 4px 0;
  }
  
  /* Sidebar styles */
  .sidebar-box {
    margin-bottom: 20px;
    background-color: #fff;
    border: 1px solid #eaecf0;
    border-radius: 8px;
    overflow: hidden;
  }
  
  .sidebar-box-header {
    background-color: #f5f7fa;
    padding: 12px 15px;
    font-weight: 600;
    color: #333;
    border-bottom: 1px solid #eaecf0;
  }
  
  .sidebar-box-content {
    padding: 15px;
  }
  
  .resource-uri {
    word-break: break-all;
    font-size: 0.9em;
    background-color: #f5f5f5;
    padding: 12px;
    border-radius: 4px;
    border: 1px solid #eaecf0;
    font-family: monospace;
  }
  
  .download-links li {
    margin-bottom: 10px;
  }
  
  .download-links .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
  }
  
  /* Property groups */
  .property-group {
    margin-bottom: 25px;
    border: 1px solid #eaecf0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }
  
  .property-group-header {
    background-color: #f3f4f6;
    padding: 12px 15px;
    font-weight: 600;
    color: #444;
    border-bottom: 1px solid #eaecf0;
  }
  
  .property-group-content {
    padding: 15px;
  }
  
  /* Property table */
  .property-table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .property-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #eaecf0;
    vertical-align: top;
  }
  
  .property-table tr:last-child td {
    border-bottom: none;
  }
  
  .property-name {
    width: 30%;
    font-weight: 600;
    color: #555;
  }
  
  /* Info box for subjects */
  .info-box {
    background-color: #f5f5f5;
    border-left: 4px solid #2196F3;
    padding: 15px;
    border-radius: 0 4px 4px 0;
  }
  
  .info-box h3 {
    margin-top: 0;
    color: #1976d2;
    font-weight: 600;
  }
  
  .info-box ul {
    padding-left: 20px;
  }
  
  .info-box li {
    margin-bottom: 5px;
  }
  
  /* Relationships */
  .relationships-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }
  
  .relationships-table th {
    background-color: #f5f7fa;
    padding: 10px;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid #eaecf0;
  }
  
  .relationships-table td {
    padding: 10px;
    border-bottom: 1px solid #eaecf0;
    vertical-align: top;
  }
  
  .relationships-table tr:hover {
    background-color: #f8f9fa;
  }
  
  .relationship-details {
    background-color: #f8f9fa;
    padding: 15px;
  }
  
  .relationship-diagram {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
  
  .object-relation {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 14px;
    font-weight: 500;
  }
  
  .object-relation.domain {
    background-color: #e6f3ff;
    border: 1px solid #b3d9ff;
  }
  
  .object-relation.property {
    background-color: #fff0e6;
    border: 1px solid #ffd9b3;
  }
  
  .object-relation.range {
    background-color: #e6fff0;
    border: 1px solid #b3f0d1;
  }
  
  .relation-arrow {
    font-size: 20px;
    color: #666;
  }
  
  /* Products */
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    grid-gap: 20px;
    margin: 15px 0;
  }
  
  .product-card {
    border: 1px solid #eaecf0;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    height: 100%;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    background-color: #fff;
  }
  
  .product-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  /* Special styling for subject products */
  .product-card.subject-product {
    border-left: 4px solid #7986cb;
  }
  
  /* Special styling for object products */
  .product-card.object-product {
    border-left: 4px solid #4db6ac;
  }
  
  .product-card-header {
    padding: 12px 15px;
    border-bottom: 1px solid #eaecf0;
    background-color: #f8f9fa;
  }
  
  .product-card-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
  }
  
  .product-card-body {
    padding: 12px 15px;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }
  
  .product-card-body .description {
    margin: 0 0 12px 0;
    font-size: 14px;
    color: #555;
    line-height: 1.5;
  }
  
  .product-meta {
    margin-top: auto;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    padding-top: 10px;
    border-top: 1px solid #f0f0f0;
  }
  
  .product-tag {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
  }
  
  .subject-tag {
    background-color: #e8eaf6;
    color: #3f51b5;
    border: 1px solid #c5cae9;
  }
  
  .object-tag {
    background-color: #e0f2f1;
    color: #009688;
    border: 1px solid #b2dfdb;
  }
  
  .notor-tag {
    background-color: #e3f2fd;
    color: #1976d2;
    border: 1px solid #bbdefb;
  }
  
  .view-more-container {
    text-align: center;
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid #eaecf0;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .resource-container {
      flex-direction: column;
    }
    
    .resource-sidebar {
      order: -1;
      margin-bottom: 20px;
    }
    
    .product-grid {
      grid-template-columns: 1fr;
    }
    
    .relationship-diagram {
      flex-direction: column;
    }
    
    .relation-arrow {
      transform: rotate(90deg);
    }
  }
</style>

<script>
  // Function to toggle relationship details
  function showRelationshipDetails(relationshipId) {
    const detailsRow = document.getElementById('relationship-details-' + relationshipId);
    if (detailsRow) {
      const isVisible = detailsRow.style.display !== 'none';
      detailsRow.style.display = isVisible ? 'none' : 'table-row';
    }
  }
</script>