<body>
  <div class="page-container">
    <!-- Table of Contents Sidebar -->
    <div class="toc-sidebar">
      <div class="toc-content">
        <h3>Table of Contents</h3>
        <ul class="toc-list">
          <li><a href="#metadata" class="toc-active">Metadata</a></li>
          <li><a href="#overview">Overview</a></li>
          {{#if ontology.subjects}}
          <li>
            <a href="#classes">Classes</a>
            <ul class="toc-sublist">
              {{#each ontology.subjects}}
                {{#if (eq this.typeClass "class-tag")}}
                <li><a href="#class-{{this.uri}}">{{this.label}}</a></li>
                {{/if}}
              {{/each}}
            </ul>
          </li>
          <li>
            <a href="#object-properties">Object Properties</a>
            <ul class="toc-sublist">
              {{#each ontology.subjects}}
                {{#if (eq this.typeClass "property-tag")}}
                <li><a href="#prop-{{this.uri}}">{{this.label}}</a></li>
                {{/if}}
              {{/each}}
            </ul>
          </li>
          {{/if}}
          <li><a href="#annotation-properties">Annotation Properties</a></li>
          <li><a href="#namespaces">Namespaces</a></li>
          <li><a href="#legend">Legend</a></li>
          <li><a href="#downloads">Downloads</a></li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="ontology-container">
      <h1>{{ontology.title}}</h1>

      <h2 id="metadata">Metadata</h2>
      <div class="metadata-section">
        <p><strong>IRI</strong><br>
        <code>{{ontology.uri}}</code></p>

        <p><strong>Title</strong><br>
        {{ontology.title}}</p>

        {{#if ontology.creator}}
        <p><strong>Creator</strong><br>
        {{ontology.creator}}</p>
        {{/if}}

        {{#if ontology.publisher}}
        <p><strong>Publisher</strong><br>
        {{ontology.publisher}}
        </p>
        {{/if}}

        {{#if ontology.created}}
        <p><strong>Date Created</strong><br>
        {{ontology.created}}</p>
        {{/if}}

        {{#if ontology.modified}}
        <p><strong>Date Modified</strong><br>
        {{ontology.modified}}</p>
        {{/if}}

        {{#if ontology.license}}
        <p><strong>License</strong><br>
        <a href="{{ontology.license}}">{{ontology.license}}</a></p>
        {{/if}}

        {{#if ontology.version}}
        <p><strong>Version</strong><br>
        {{ontology.version}}</p>
        {{/if}}

        <p><strong>Description</strong><br>
        {{ontology.description}}</p>
      </div>

      <h2 id="overview">Overview</h2>
      <div class="overview-section">
        <p><strong>Figure 1: </strong>Ontology overview</p>
        
        <div class="stats-summary">
          <div class="stat-item">
            <span class="stat-value">{{ontology.stats.classes}}</span> Classes
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ontology.stats.properties}}</span> Properties
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ontology.stats.individuals}}</span> Individuals
          </div>
        </div>
        
        <p>{{ontology.description}}</p>

        {{#if ontology.relationships}}
        <div class="relationships-container">
          <h3>Key Relationships</h3>
          <table class="relationships-table">
            <tr>
              <th>Property</th>
              <th>Domain</th>
              <th>Range</th>
            </tr>
            {{#each ontology.relationships}}
            <tr>
              <td>
                <a href="/resource?uri={{property.uri}}">
                  {{#if ../showLabels}}
                    {{property.label}}
                  {{else}}
                    {{property.uri}}
                  {{/if}}
                </a>
              </td>
              <td>
                {{#if domain.uri}}
                <a href="/resource?uri={{domain.uri}}">
                  {{#if ../showLabels}}
                    {{domain.label}}
                  {{else}}
                    {{domain.uri}}
                  {{/if}}
                </a>
                {{else}}
                -
                {{/if}}
              </td>
              <td>
                {{#if range.uri}}
                <a href="/resource?uri={{range.uri}}">
                  {{#if ../showLabels}}
                    {{range.label}}
                  {{else}}
                    {{range.uri}}
                  {{/if}}
                </a>
                {{else}}
                -
                {{/if}}
              </td>
            </tr>
            {{/each}}
          </table>
        </div>
        {{/if}}
      </div>

      {{#if ontology.subjects}}
      <h2 id="classes">Classes</h2>
      <div class="classes-section">
        <div class="filter-control">
          <input type="text" id="classFilter" placeholder="Filter classes..." class="filter-input">
        </div>
        
        <div class="entity-items">
          {{#each ontology.subjects}}
            {{#if (eq this.typeClass "class-tag")}}
            <div id="class-{{encodeURIComponent this.uri}}" class="entity-item class-item">
              <h3>{{this.label}} <sup>c</sup></h3>
              <p><strong>IRI</strong><br><code>{{this.uri}}</code></p>
              
              {{#if this.description}}
              <p><strong>Description</strong><br>
              {{this.description}}</p>
              {{/if}}
              
              <!-- Add more class properties from GraphDB if available -->
            </div>
            {{/if}}
          {{/each}}
        </div>
      </div>

      <h2 id="object-properties">Object Properties</h2>
      <div class="properties-section">
        <div class="filter-control">
          <input type="text" id="propFilter" placeholder="Filter properties..." class="filter-input">
        </div>
        
        <div class="entity-items">
          {{#each ontology.subjects}}
            {{#if (eq this.typeClass "property-tag")}}
            <div id="prop-{{encodeURIComponent this.uri}}" class="entity-item property-item">
              <h3>{{this.label}} <sup>op</sup></h3>
              <p><strong>IRI</strong><br><code>{{this.uri}}</code></p>
              
              {{#if this.description}}
              <p><strong>Description</strong><br>
              {{this.description}}</p>
              {{/if}}
              
              <!-- Add more property details from GraphDB if available -->
            </div>
            {{/if}}
          {{/each}}
        </div>
      </div>
      {{/if}}

      <h2 id="annotation-properties">Annotation Properties</h2>
      <div class="annotation-props-section">
        <div class="entity-items">
          {{#each ontology.subjects}}
            {{#if (eq this.typeClass "annotation-tag")}}
            <div id="annot-{{encodeURIComponent this.uri}}" class="entity-item">
              <h3>
                <a href="#annot-{{encodeURIComponent this.uri}}" class="property-title-link">
                  {{this.label}} <sup>ap</sup>
                </a>
              </h3>
              <p><strong>IRI</strong>
                <a href="#annot-{{encodeURIComponent this.uri}}" class="iri-link">
                  <code>{{this.uri}}</code>
                </a>
              </p>
              <div class="property-description">
                <p>{{this.description}}</p>
              </div>
            </div>
            {{/if}}
          {{/each}}

          <!-- Common annotation properties if none found in the data -->
          {{#unless hasAnnotationProperties}}
          <div id="annot-label" class="entity-item">
            <h3>
              <a href="#annot-label" class="property-title-link">
                label <sup>ap</sup>
              </a>
            </h3>
            <p><strong>IRI</strong>
              <a href="#annot-label" class="iri-link">
                <code>http://www.w3.org/2000/01/rdf-schema#label</code>
              </a>
            </p>
            <div class="property-description">
              <p>A human-readable name for the subject.</p>
            </div>
          </div>
          
          <div id="annot-comment" class="entity-item">
            <h3>
              <a href="#annot-comment" class="property-title-link">
                comment <sup>ap</sup>
              </a>
            </h3>
            <p><strong>IRI</strong>
              <a href="#annot-comment" class="iri-link">
                <code>http://www.w3.org/2000/01/rdf-schema#comment</code>
              </a>
            </p>
            <div class="property-description">
              <p>A description of the subject resource.</p>
            </div>
          </div>
          {{/unless}}
        </div>
      </div>

      <h2 id="namespaces">Namespaces</h2>
      <div class="namespaces-section">
        <table class="namespaces-table">
          {{#if commonNamespaces}}
            {{#each commonNamespaces}}
            <tr>
              <td><strong>{{this.prefix}}</strong></td>
              <td><code>{{this.uri}}</code></td>
            </tr>
            {{/each}}
          {{else}}
            <tr>
              <td><strong>rdf</strong></td>
              <td><code>http://www.w3.org/1999/02/22-rdf-syntax-ns#</code></td>
            </tr>
            <tr>
              <td><strong>rdfs</strong></td>
              <td><code>http://www.w3.org/2000/01/rdf-schema#</code></td>
            </tr>
            <tr>
              <td><strong>owl</strong></td>
              <td><code>http://www.w3.org/2002/07/owl#</code></td>
            </tr>
            <tr>
              <td><strong>xsd</strong></td>
              <td><code>http://www.w3.org/2001/XMLSchema#</code></td>
            </tr>
          {{/if}}
        </table>
      </div>

      <h2 id="legend">Legend</h2>
      <div class="legend-section">
        <p><sup>c</sup> Classes <sup>op</sup> Object Properties <sup>ap</sup> Annotation Properties</p>
      </div>
      
      <div id="downloads" class="download-section">
        <h2>Downloads</h2>
        <div class="download-links">
          {{#each downloadLinks}}
          <a href="{{this.url}}" class="download-link" download="ontology.{{this.extension}}">
            Download as {{this.format}}
          </a>
          {{/each}}
        </div>
      </div>
    
      <div class="display-control">
        <label for="displayToggle">Show human-readable labels:</label>
        <label class="toggle-switch">
          <input type="checkbox" id="displayToggle" {{#if showLabels}}checked{{/if}}>
          <span class="toggle-slider"></span>
        </label>
        <span class="toggle-label">{{#if showLabels}}On{{else}}Off{{/if}}</span>
      </div>
    
      <div class="navigation-links">
        <a href="/" class="nav-link">Back to Home</a>
        <a href="/ontology/products?uri={{encodeURIComponent ontology.uri}}" class="nav-link">View Related Products</a>
        {{#if ontology.relatedOntologies}}
        <a href="/class/browse" class="nav-link">Browse Classes</a>
        {{/if}}
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize filtering
      initFilter('#classFilter', '.class-item');
      initFilter('#propFilter', '.property-item');
      
      // Update display toggle
      const displayToggle = document.getElementById('displayToggle');
      const toggleLabel = document.querySelector('.toggle-label');
      
      if (displayToggle && toggleLabel) {
        displayToggle.addEventListener('change', function() {
          // Update the label text
          toggleLabel.textContent = this.checked ? 'On' : 'Off';
          
          // Create URL with updated showLabels parameter
          const url = new URL(window.location.href);
          url.searchParams.set('showLabels', this.checked ? 'true' : 'false');
          
          // Redirect to the new URL
          window.location.href = url.toString();
        });
      }
      
      // Initialize TOC highlight on scroll
      initTOCHighlight();
      
      // Make the TOC stay in view when scrolling
      window.addEventListener('scroll', function() {
        const toc = document.querySelector('.toc-sidebar');
        if (toc) {
          if (window.innerWidth > 992) { // Only apply this on larger screens
            const scrollPosition = window.scrollY;
            toc.style.top = (scrollPosition > 0) ? '0' : '';
          }
        }
      });
      
      // Smooth scrolling for anchor links
      document.querySelectorAll('.toc-list a, .toc-sublist a').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
          e.preventDefault();
          
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          
          if (targetElement) {
            window.scrollTo({
              top: targetElement.offsetTop - 20,
              behavior: 'smooth'
            });
            
            // Update URL without reload
            history.pushState(null, null, `#${targetId}`);
            
            // Highlight the clicked TOC item
            highlightTOCItem(this);
          }
        });
      });
      
      // Check for hash in URL on page load to scroll to section
      if (window.location.hash) {
        const targetId = window.location.hash.substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          setTimeout(() => {
            window.scrollTo({
              top: targetElement.offsetTop - 20,
              behavior: 'auto'
            });
            
            // Find and highlight the corresponding TOC item
            const tocItem = document.querySelector(`.toc-list a[href="#${targetId}"], .toc-sublist a[href="#${targetId}"]`);
            if (tocItem) {
              highlightTOCItem(tocItem);
            }
          }, 100);
        }
      }
    });
    
    // Function to initialize filtering
    function initFilter(inputSelector, itemSelector) {
      const input = document.querySelector(inputSelector);
      if (!input) return;
      
      input.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const items = document.querySelectorAll(itemSelector);
        
        items.forEach(item => {
          // Check if item contains the search term
          const text = item.textContent.toLowerCase();
          
          if (searchTerm === '' || text.includes(searchTerm)) {
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        });
      });
    }
    
    // Function to highlight active TOC item
    function highlightTOCItem(item) {
      // Remove active class from all TOC items
      document.querySelectorAll('.toc-list a, .toc-sublist a').forEach(link => {
        link.classList.remove('toc-active');
      });
      
      // Add active class to the clicked item
      item.classList.add('toc-active');
    }
    
    // Function to highlight TOC items based on scroll position
    function initTOCHighlight() {
      // Get all section elements
      const sections = document.querySelectorAll('h2[id], .entity-item[id]');
      
      // Observe sections visibility
      window.addEventListener('scroll', function() {
        let currentSection = '';
        const scrollPosition = window.scrollY;
        
        // Find the current section
        sections.forEach(section => {
          const sectionTop = section.offsetTop - 100;
          const sectionHeight = section.offsetHeight;
          
          if (scrollPosition >= sectionTop && scrollPosition < sectionTop + sectionHeight) {
            currentSection = section.getAttribute('id');
          }
        });
        
        // Highlight the corresponding TOC item
        if (currentSection) {
          const tocItem = document.querySelector(`.toc-list a[href="#${currentSection}"], .toc-sublist a[href="#${currentSection}"]`);
          
          if (tocItem) {
            document.querySelectorAll('.toc-list a, .toc-sublist a').forEach(link => {
              link.classList.remove('toc-active');
            });
            
            tocItem.classList.add('toc-active');
            
            // If it's a subitem, also highlight its parent
            const parent = tocItem.closest('.toc-sublist');
            if (parent && parent.previousElementSibling) {
              parent.previousElementSibling.classList.add('toc-active');
            }
          }
        }
      });
    }
  </script>
</body>