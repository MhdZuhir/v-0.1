<!-- views/ontology-detail.handlebars -->
<ul class="breadcrumbs">
  <li><a href="/?showLabels={{showLabels}}">Hem</a></li>
  <li>{{ontology.title}}</li>
</ul>

<h1>{{ontology.title}}</h1>

<div class="display-mode">
  <label for="displayToggle">Visa mänskligt läsbara etiketter:</label>
  <label class="switch">
    <input type="checkbox" id="displayToggle" {{#if showLabels}}checked{{/if}}>
    <span class="slider"></span>
  </label>
  <span class="display-mode-text">{{#if showLabels}}På{{else}}Av{{/if}}</span>
</div>

<div class="resource-container">
  <div class="resource-main">
    <div class="resource-description">
      {{ontology.description}}
    </div>
    
    <div class="property-group">
      <div class="property-group-header">Metadata</div>
      <div class="property-group-content">
        <table class="property-table">
          {{#if ontology.creator}}
            <tr>
              <td class="property-name">Skapare</td>
              <td>{{ontology.creator}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.publisher}}
            <tr>
              <td class="property-name">Utgivare</td>
              <td>{{ontology.publisher}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.created}}
            <tr>
              <td class="property-name">Skapad</td>
              <td>{{ontology.created}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.modified}}
            <tr>
              <td class="property-name">Senast ändrad</td>
              <td>{{ontology.modified}}</td>
            </tr>
          {{/if}}
          
          {{#if ontology.version}}
            <tr>
              <td class="property-name">Version</td>
              <td>{{ontology.version}}</td>
            </tr>
          {{/if}}
        </table>
      </div>
    </div>
    
    <div class="property-group">
      <div class="property-group-header">Statistik</div>
      <div class="property-group-content">
        <table class="property-table">
          <tr>
            <td class="property-name">Klasser</td>
            <td>{{ontology.stats.classes}}</td>
          </tr>
          <tr>
            <td class="property-name">Egenskaper</td>
            <td>{{ontology.stats.properties}}</td>
          </tr>
          <tr>
            <td class="property-name">Individer</td>
            <td>{{ontology.stats.individuals}}</td>
          </tr>
        </table>
      </div>
    </div>
    
    <!-- Add the products section here -->
    {{#if relatedProducts.length}}
    <div class="property-group">
      <div class="property-group-header">Relaterade Produkter</div>
      <div class="property-group-content">
        <div class="product-grid">
          {{#each relatedProducts}}
            <div class="product-card">
              <div class="product-card-header">
                <h3>
                  <a href="/product/detail?uri={{encodeURIComponent this.uri}}&showLabels={{../showLabels}}">
                    {{this.name}}
                  </a>
                </h3>
              </div>
              <div class="product-card-body">
                {{#if this.description}}
                  <p class="description">{{truncate this.description 120}}</p>
                {{else}}
                  <p class="description"><em>Ingen beskrivning tillgänglig</em></p>
                {{/if}}
                
                {{#if this.isNotor}}
                  <span class="product-tag notor-tag">Notor65</span>
                {{/if}}
              </div>
            </div>
          {{/each}}
        </div>
      </div>
    </div>
    {{/if}}
    
    <!-- Add debugging tool to explore classes -->
    <div class="property-group">
      <div class="property-group-header">Utforska ontologin</div>
      <div class="property-group-content">
        <p>Använd dessa länkar för att utforska innehållet i ontologin:</p>
        
        <ul style="list-style: none; padding-left: 0; margin-top: 15px;">
          <li style="margin-bottom: 10px;">
            <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?class ?label WHERE { { ?class a <http://www.w3.org/2002/07/owl#Class> . FILTER(STRSTARTS(STR(?class), STR(<' ontology.uri '>))) } UNION { ?class a <http://www.w3.org/2000/01/rdf-schema#Class> . FILTER(STRSTARTS(STR(?class), STR(<' ontology.uri '>))) } OPTIONAL { ?class <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?class LIMIT 100')}}&showLabels={{showLabels}}" class="btn" style="width: 100%;">
              Visa klasser
            </a>
          </li>
          <li style="margin-bottom: 10px;">
            <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?property ?label WHERE { { ?property a <http://www.w3.org/2002/07/owl#ObjectProperty> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } UNION { ?property a <http://www.w3.org/2002/07/owl#DatatypeProperty> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } UNION { ?property a <http://www.w3.org/1999/02/22-rdf-syntax-ns#Property> . FILTER(STRSTARTS(STR(?property), STR(<' ontology.uri '>))) } OPTIONAL { ?property <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?property LIMIT 100')}}&showLabels={{showLabels}}" class="btn" style="width: 100%;">
              Visa egenskaper
            </a>
          </li>
          <li style="margin-bottom: 10px;">
            <a href="/query?query={{encodeURIComponent (concat 'SELECT DISTINCT ?individual ?label WHERE { { ?individual a <http://www.w3.org/2002/07/owl#NamedIndividual> . FILTER(STRSTARTS(STR(?individual), STR(<' ontology.uri '>))) } UNION { ?individual a ?class . ?class <http://www.w3.org/2000/01/rdf-schema#isDefinedBy> <' ontology.uri '> . FILTER NOT EXISTS { ?individual a <http://www.w3.org/2002/07/owl#NamedIndividual> } } OPTIONAL { ?individual <http://www.w3.org/2000/01/rdf-schema#label> ?label } } ORDER BY ?individual LIMIT 100')}}&showLabels={{showLabels}}" class="btn" style="width: 100%;">
              Visa individer
            </a>
          </li>
          <li>
            <a href="/graphdb?query={{encodeURIComponent (concat 'SELECT * WHERE { ?s ?p ?o . FILTER(STRSTARTS(STR(?s), STR(<' ontology.uri '>))) } LIMIT 100')}}&showLabels={{showLabels}}" class="btn" style="width: 100%;">
              Visa alla triplar
            </a>
          </li>
          <li style="margin-top: 10px;">
            <a href="/ontology/products?uri={{encodeURIComponent ontology.uri}}&showLabels={{showLabels}}" class="btn" style="width: 100%;">
              Visa alla produkter för denna ontologi
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="resource-sidebar">
    <div class="sidebar-box">
      <div class="sidebar-box-header">Nedladdningslänkar</div>
      <div class="sidebar-box-content">
        <ul class="download-links" style="list-style: none; padding: 0;">
          {{#each downloadLinks}}
            <li style="margin-bottom: 10px;">
              <a href="{{this.url}}" 
                 class="btn" 
                 style="width: 100%; text-align: center;">
                Ladda ner som {{this.format}}
              </a>
            </li>
          {{/each}}
        </ul>
      </div>
    </div>
    
    <div class="sidebar-box">
      <div class="sidebar-box-header">URI</div>
      <div class="sidebar-box-content">
        <div class="resource-uri">
          <code>{{ontology.uri}}</code>
        </div>
      </div>
    </div>
    
    <div class="sidebar-box">
      <div class="sidebar-box-header">Åtgärder</div>
      <div class="sidebar-box-content">
        <p>
          <a href="/?showLabels={{showLabels}}" class="btn" style="width: 100%; margin-bottom: 8px;">Tillbaka till startsidan</a>
        </p>
        <p>
          <a href="/query?showLabels={{showLabels}}" class="btn" style="width: 100%;">Kör anpassad SPARQL-fråga</a>
        </p>
        <p>
          <a href="/ontology/debug-products?showLabels={{showLabels}}" class="btn" style="width: 100%; margin-top: 8px;">Visa alla produkter i systemet</a>
        </p>
      </div>
    </div>
  </div>
</div>

<style>
  .resource-description {
    font-size: 1.1em;
    line-height: 1.6;
    margin-bottom: 25px;
    color: #333;
    background-color: #f9f9f9;
    padding: 20px;
    border-left: 4px solid #0645ad;
    border-radius: 0 4px 4px 0;
  }
  
  .download-links .btn {
    display: flex;
    align-items: center;  
    justify-content: center;
  }
  
  .sidebar-box .resource-uri {
    word-break: break-all;
    font-size: 0.9em;
    background-color: #f5f5f5;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #eaecf0;
  }
  
  /* Product grid styles */
  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    grid-gap: 20px;
    margin-top: 15px;
  }
  
  .product-card {
    border: 1px solid #eaecf0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    background-color: #fff;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .product-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  .product-card-header {
    padding: 12px 15px;
    border-bottom: 1px solid #eaecf0;
    background-color: #f8f9fa;
  }
  
  .product-card-header h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
  }
  
  .product-card-body {
    padding: 12px 15px;
    position: relative;
  }
  
  .product-card-body .description {
    margin: 0;
    font-size: 14px;
    color: #555;
    line-height: 1.5;
    margin-bottom: 8px;
  }
  
  .product-tag {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
  }
  
  .notor-tag {
    background-color: #e3f2fd;
    color: #1976d2;
    border: 1px solid #bbdefb;
  }
</style>